<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>çŠ¶æ³å¿œç­”å‹ARãƒã‚¹ã‚¿ãƒ¼ (Wizard of Oz)</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
    body { margin: 0; overflow: hidden; }

    /* --- Wizard of Oz (ãƒ‡ãƒãƒƒã‚°) ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
    #control-panel {
      position: fixed;
      bottom: 30px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 20px;
      z-index: 9999; /* ARç”»é¢ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã«å¿…é ˆ */
    }

    .mode-btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      transition: transform 0.1s ease;
    }

    .mode-btn:active { transform: scale(0.95); }

    /* æ˜¼ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    #btn-day { background-color: #e67e22; }
    /* å¤œãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    #btn-night { background-color: #2c3e50; }
  </style>
</head>
<body>

  <div id="control-panel">
    <button id="btn-day" class="mode-btn">â˜€ï¸ æ˜¼ãƒ¢ãƒ¼ãƒ‰</button>
    <button id="btn-night" class="mode-btn">ğŸŒ™ å¤œãƒ¢ãƒ¼ãƒ‰</button>
  </div>

  <a-scene 
    mindar-image="imageTargetSrc: ./assets/target.mind; uiScanning: yes;" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <video id="vid-day" 
        src="./assets/video-day.mp4" 
        preload="auto" 
        loop="true" 
        playsinline 
        webkit-playsinline 
        muted 
        crossorigin="anonymous"></video>

      <img id="img-night" src="./assets/image-night.png" crossorigin="anonymous" />
    </a-assets>

    <a-camera position="0 0 0" look-controls="false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      
      <a-video 
        id="ar-content-day"
        src="#vid-day" 
        position="0 0 0" 
        height="1" 
        width="1" 
        rotation="0 0 0"
        visible="true">
      </a-video>

      <a-image 
        id="ar-content-night"
        src="#img-night" 
        position="0 0 0" 
        height="1" 
        width="1" 
        rotation="0 0 0"
        visible="false">
      </a-image>

    </a-entity>
  </a-scene>

  <script>
    // DOMã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã£ã¦å‡¦ç†ã‚’é–‹å§‹
    document.addEventListener("DOMContentLoaded", () => {
      
      // 1. å„è¦ç´ ã®å‚ç…§ã‚’å–å¾—
      const btnDay = document.getElementById('btn-day');
      const btnNight = document.getElementById('btn-night');
      
      const elArDay = document.getElementById('ar-content-day'); // A-Frameã®å‹•ç”»ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
      const elArNight = document.getElementById('ar-content-night'); // A-Frameã®ç”»åƒã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
      
      const rawVideo = document.getElementById('vid-day'); // HTMLã®ç”Ÿã®videoã‚¿ã‚°

      // 2. ã€Œæ˜¼ãƒ¢ãƒ¼ãƒ‰ã€ã¸ã®åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
      const setDayMode = () => {
        console.log("Switching to Day Mode");

        // è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ (æ’ä»–åˆ¶å¾¡)
        elArDay.setAttribute('visible', true);
        elArNight.setAttribute('visible', false);

        // å‹•ç”»ã®åˆ¶å¾¡: è¡¨ç¤ºã™ã‚‹ã¨ãã ã‘å†ç”Ÿã™ã‚‹
        // â€»iOSç­‰ã®çœé›»åŠ›åˆ¶é™å¯¾ç­–ã¨ã—ã¦ã€éè¡¨ç¤ºæ™‚ã¯æ­¢ã‚ã‚‹ã®ãŒé‰„å‰‡
        rawVideo.play().catch(e => {
            console.warn("å‹•ç”»ã®è‡ªå‹•å†ç”ŸãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦ã§ã™ã€‚", e);
        });
      };

      // 3. ã€Œå¤œãƒ¢ãƒ¼ãƒ‰ã€ã¸ã®åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
      const setNightMode = () => {
        console.log("Switching to Night Mode");

        // è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
        elArDay.setAttribute('visible', false);
        elArNight.setAttribute('visible', true);

        // å‹•ç”»ã®åˆ¶å¾¡: è¦‹ãˆãªã„ã¨ãã¯ä¸€æ™‚åœæ­¢ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¯€ç´„
        rawVideo.pause();
      };

      // 4. ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²
      btnDay.addEventListener('click', (e) => {
        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã¨ã¿ãªã•ã‚Œã‚‹ãŸã‚ã€
        // ã“ã“ã§å‹•ç”»å†ç”Ÿã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã¨ã‚¹ãƒãƒ›ã§ã‚‚éŸ³ãŒé³´ã‚‰ã›ãŸã‚Šå†ç”ŸãŒå®‰å®šã—ã¾ã™
        e.stopPropagation(); // ARç”»é¢ã¸ã®ã‚¿ãƒƒãƒå¹²æ¸‰ã‚’é˜²ã
        setDayMode();
      });

      btnNight.addEventListener('click', (e) => {
        e.stopPropagation();
        setNightMode();
      });

      // 5. MindARã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
      // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¦‹ã¤ã‘ãŸ/è¦‹å¤±ã£ãŸã¨ãã®ãƒ­ã‚°
      const sceneEl = document.querySelector('a-scene');
      const targetEl = document.querySelector('[mindar-image-target]');

      targetEl.addEventListener("targetFound", event => {
        console.log("Marker Found");
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¦‹ã¤ã‘ãŸã¨ãã«ç¾åœ¨ãŒæ˜¼ãƒ¢ãƒ¼ãƒ‰ãªã‚‰å‹•ç”»ã‚’ç¢ºå®Ÿã«å†ç”Ÿã•ã›ã‚‹
        if(elArDay.getAttribute('visible')) {
            rawVideo.play();
        }
      });

      targetEl.addEventListener("targetLost", event => {
        console.log("Marker Lost");
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¦‹å¤±ã£ãŸã‚‰å‹•ç”»ã‚’æ­¢ã‚ã‚‹ (ãƒãƒƒãƒ†ãƒªãƒ¼ç¯€ç´„)
        rawVideo.pause();
      });

    });
  </script>
</body>
</html>